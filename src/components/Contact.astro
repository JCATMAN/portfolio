---
import SectionHeading from "./SectionHeading.astro";

const contactWebhook = import.meta.env.PUBLIC_N8N_CONTACT_WEBHOOK;
---

<section
  id="contact"
  class="section bg-white dark:bg-slate-950 relative overflow-hidden"
>
  <!-- Decorative elements -->
  <div
    class="absolute bottom-0 left-0 w-96 h-96 bg-primary-400/5 rounded-full blur-3xl -translate-x-1/2 translate-y-1/2"
  >
  </div>

  <div class="container relative">
    <SectionHeading
      title="Get In Touch"
      subtitle="Have a project in mind or want to discuss potential opportunities? I'm always open to new ideas and collaborations."
    />

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <!-- Contact Info -->
      <div data-aos="fade-right">
        <h3
          class="text-2xl font-bold mb-6 text-slate-900 dark:text-white font-heading"
        >
          Let's Connect
        </h3>
        <p class="text-slate-600 dark:text-slate-400 mb-8 leading-relaxed">
          I'm currently available for freelance work and full-time
          opportunities. If you're interested in working together or have any
          questions, feel free to reach out using the form or through my contact
          details below.
        </p>

        <div class="space-y-6">
          <div class="flex items-start">
            <div
              class="flex-shrink-0 bg-primary-100 dark:bg-primary-900/30 p-3 rounded-full"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-primary-600 dark:text-primary-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h4
                class="text-lg font-medium text-slate-900 dark:text-white mb-1"
              >
                Email
              </h4>
              <a
                href="mailto:jose.hernandezhoyos@gmail.com"
                class="text-slate-600 dark:text-slate-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                jose.hernandezhoyos@gmail.com
              </a>
            </div>
          </div>

          <div class="flex items-start">
            <div
              class="flex-shrink-0 bg-primary-100 dark:bg-primary-900/30 p-3 rounded-full"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-primary-600 dark:text-primary-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
            </div>
            <div class="ml-4">
              <h4
                class="text-lg font-medium text-slate-900 dark:text-white mb-1"
              >
                Phone
              </h4>
              <a
                href="tel:+573182197116"
                class="text-slate-600 dark:text-slate-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                +57 (318) 219-7116
              </a>
            </div>
          </div>

          <div class="flex items-start">
            <div
              class="flex-shrink-0 bg-primary-100 dark:bg-primary-900/30 p-3 rounded-full"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-primary-600 dark:text-primary-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
            </div>
            <div class="ml-4">
              <h4
                class="text-lg font-medium text-slate-900 dark:text-white mb-1"
              >
                Location
              </h4>
              <p class="text-slate-600 dark:text-slate-400">
                Medellín, Colombia
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Form -->
      <div class="glass-card p-6 md:p-8" data-aos="fade-left">
        <form id="contact-form" class="space-y-6" method="POST" action="#">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div>
              <label
                for="name"
                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                >Name</label
              >
              <input
                type="text"
                id="name"
                name="name"
                class="input"
                placeholder="Your Name"
                required
              />
            </div>
            <div>
              <label
                for="email"
                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
                >Email</label
              >
              <input
                type="email"
                id="email"
                name="email"
                class="input"
                placeholder="your.email@example.com"
                required
              />
            </div>
          </div>

          <div>
            <label
              for="subject"
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
              >Subject</label
            >
            <input
              type="text"
              id="subject"
              name="subject"
              class="input"
              placeholder="How can I help you?"
              required
            />
          </div>

          <div>
            <label
              for="message"
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"
              >Message</label
            >
            <textarea
              id="message"
              name="message"
              rows="5"
              class="input resize-none"
              placeholder="Your message here..."
              required></textarea>
          </div>

          <button type="submit" class="btn-primary w-full">Send Message</button>
        </form>
        <p class="text-xs text-slate-600 dark:text-slate-400 mt-2 text-center">
          ⚙️ Powered by <a href="https://n8n.io" target="_blank" class="link"
            >n8n</a
          > – automation workflow built and self-hosted by me
        </p>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ contactWebhook }}>
  const form = /** @type {HTMLFormElement} */ (
    document.getElementById("contact-form")
  );
  const submitBtn = /** @type {HTMLButtonElement} */ (
    form?.querySelector('button[type="submit"]')
  );

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      subject: formData.get("subject"),
      message: formData.get("message"),
    };
    try {
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Sending...";
      }

      const response = await fetch(contactWebhook, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error("Failed to send");

      if (submitBtn) {
        submitBtn.textContent = "Message Sent!";
        submitBtn.classList.add("bg-success-600", "hover:bg-success-700");
      }
      if (form) form.reset();
    } catch (err) {
      if (submitBtn) {
        submitBtn.textContent = "Error sending message";
        submitBtn.classList.add("bg-red-600", "hover:bg-red-700");
      }
      console.error(err);
    } finally {
      if (submitBtn) {
        submitBtn.disabled = false;
      }
    }
  });
</script>
